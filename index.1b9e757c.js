const e=new class{deepCopy(e){return e.map(e=>e.slice())}constructor(e){this.board=e?this.deepCopy(e):this.deepCopy([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),this.initialBoardState=this.deepCopy(this.board),this.score=0,this.status="idle",this.isStarted=!1}generateNewTile(){let e=[];for(let t=0;t<4;t++)for(let s=0;s<4;s++)0===this.board[t][s]&&e.push({row:t,col:s});if(0===e.length)return!1;let t=Math.floor(Math.random()*e.length),{row:s,col:r}=e[t],i=.1>Math.random()?4:2;return this.board[s][r]=i,!0}processLine(e){let t=0,s=e.filter(e=>0!==e);for(let e=0;e<s.length-1;e++)s[e]===s[e+1]&&(s[e]*=2,t+=s[e],s[e+1]=0);for(s=s.filter(e=>0!==e);s.length<4;)s.push(0);return{newLine:s,scoreChange:t}}transposeBoard(e){let t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];for(let s=0;s<4;s++)for(let r=0;r<4;r++)t[s][r]=e[r][s];return t}checkWin(){for(let e=0;e<4;e++)for(let t=0;t<4;t++){if(2048===this.board[e][t])return this.status="win",!0;let s=this.board[e][t];if(t<3&&this.board[e][t+1]===s||e<3&&this.board[e+1][t]===s)return!0}return!1}hasAvailableMoves(){for(let e=0;e<4;e++)for(let t=0;t<4;t++){if(0===this.board[e][t])return!0;let s=this.board[e][t];if(t<3&&this.board[e][t+1]===s||e<3&&this.board[e+1][t]===s)return!0}return!1}checkGameStatus(){this.checkWin()||this.hasAvailableMoves()||(this.status="lose")}moveLeft(){if("playing"!==this.status)return!1;let e=this.deepCopy(this.board),t=!1;for(let s=0;s<4;s++){let{newLine:r,scoreChange:i}=this.processLine(this.board[s]);this.score+=i,e[s].join(",")!==r.join(",")&&(t=!0),this.board[s]=r}return!!t&&(this.generateNewTile(),this.checkGameStatus(),!0)}moveRight(){if("playing"!==this.status)return!1;let e=this.deepCopy(this.board),t=!1;for(let s=0;s<4;s++){let r=this.board[s];r.reverse();let{newLine:i,scoreChange:a}=this.processLine(r);this.score+=a,i.reverse(),e[s].join(",")!==i.join(",")&&(t=!0),this.board[s]=i}return!!t&&(this.generateNewTile(),this.checkGameStatus(),!0)}moveUp(){if("playing"!==this.status)return!1;let e=this.deepCopy(this.board),t=!1;this.board=this.transposeBoard(this.board);for(let e=0;e<4;e++){let{newLine:t,scoreChange:s}=this.processLine(this.board[e]);this.score+=s,this.board[e]=t}this.board=this.transposeBoard(this.board);for(let s=0;s<4;s++)if(e[s].join(",")!==this.board[s].join(",")){t=!0;break}return!!t&&(this.generateNewTile(),this.checkGameStatus(),!0)}moveDown(){if("playing"!==this.status)return!1;let e=this.deepCopy(this.board),t=!1;this.board=this.transposeBoard(this.board);for(let e=0;e<4;e++){let t=this.board[e];t.reverse();let{newLine:s,scoreChange:r}=this.processLine(t);this.score+=r,s.reverse(),this.board[e]=s}this.board=this.transposeBoard(this.board);for(let s=0;s<4;s++)if(e[s].join(",")!==this.board[s].join(",")){t=!0;break}return!!t&&(this.generateNewTile(),this.checkGameStatus(),!0)}getScore(){return this.score}getState(){return this.board}getStatus(){return this.status}start(){this.generateNewTile(),this.generateNewTile(),this.status="playing",this.isStarted=!0}restart(){this.board=this.initialBoardState.map(e=>e.slice()),this.score=0,this.status="idle",this.start()}},t=document.querySelector(".game-field"),s=document.querySelector(".button"),r=document.querySelector(".game-score"),i=document.querySelector(".message-start"),a=document.querySelector(".message-win"),o=document.querySelector(".message-lose");function n(){!function(){let s=e.getState();t.querySelectorAll(".field-cell").forEach((e,t)=>{let r=Math.floor(t/4),i=t%4;if(!s[r]||void 0===s[r][i])return;let a=s[r][i];e.textContent=0===a?"":a,e.className="field-cell",0!==a&&e.classList.add(`field-cell--${a}`)})}(),r.textContent=e.getScore(),function(){let t=e.getStatus();e.isStarted?(s.textContent="Restart",s.classList.remove("start"),s.classList.add("restart")):(s.textContent="Start",s.classList.add("start"),s.classList.remove("restart")),i.classList.add("hidden"),a.classList.add("hidden"),o.classList.add("hidden"),"win"===t?a.classList.remove("hidden"):"lose"===t?o.classList.remove("hidden"):"idle"===t&&i.classList.remove("hidden")}()}s&&t&&r&&(s.addEventListener("click",function(){"playing"===e.getStatus()||e.isStarted?e.restart():e.start(),n()}),document.addEventListener("keydown",function(t){if("playing"!==e.getStatus())return;let s=!1;switch(t.key){case"ArrowRight":s=e.moveRight();break;case"ArrowLeft":s=e.moveLeft();break;case"ArrowUp":s=e.moveUp();break;case"ArrowDown":s=e.moveDown();break;default:return}s&&(t.preventDefault(),n())}),n());
//# sourceMappingURL=index.1b9e757c.js.map
