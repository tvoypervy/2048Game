!function(){var e=new/*#__PURE__*/(function(){var e;function t(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,t),this.board=e?this.deepCopy(e):this.deepCopy([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),this.initialBoardState=this.deepCopy(this.board),this.score=0,this.status="idle",this.isStarted=!1}return e=[{key:"deepCopy",value:function(e){return e.map(function(e){return e.slice()})}},{key:"generateNewTile",value:function(){for(var e=[],t=0;t<4;t++)for(var r=0;r<4;r++)0===this.board[t][r]&&e.push({row:t,col:r});if(0===e.length)return!1;var s=Math.floor(Math.random()*e.length),a=e[s],i=a.row,o=a.col,n=.1>Math.random()?4:2;return this.board[i][o]=n,!0}},{key:"processLine",value:function(e){for(var t=0,r=e.filter(function(e){return 0!==e}),s=0;s<r.length-1;s++)r[s]===r[s+1]&&(r[s]*=2,t+=r[s],r[s+1]=0);for(r=r.filter(function(e){return 0!==e});r.length<4;)r.push(0);return{newLine:r,scoreChange:t}}},{key:"transposeBoard",value:function(e){for(var t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],r=0;r<4;r++)for(var s=0;s<4;s++)t[r][s]=e[s][r];return t}},{key:"checkWin",value:function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++){if(2048===this.board[e][t])return this.status="win",!0;var r=this.board[e][t];if(t<3&&this.board[e][t+1]===r||e<3&&this.board[e+1][t]===r)return!0}return!1}},{key:"hasAvailableMoves",value:function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++){if(0===this.board[e][t])return!0;var r=this.board[e][t];if(t<3&&this.board[e][t+1]===r||e<3&&this.board[e+1][t]===r)return!0}return!1}},{key:"checkGameStatus",value:function(){this.checkWin()||this.hasAvailableMoves()||(this.status="lose")}},{key:"moveLeft",value:function(){if("playing"!==this.status)return!1;for(var e=this.deepCopy(this.board),t=!1,r=0;r<4;r++){var s=this.processLine(this.board[r]),a=s.newLine,i=s.scoreChange;this.score+=i,e[r].join(",")!==a.join(",")&&(t=!0),this.board[r]=a}return!!t&&(this.generateNewTile(),this.checkGameStatus(),!0)}},{key:"moveRight",value:function(){if("playing"!==this.status)return!1;for(var e=this.deepCopy(this.board),t=!1,r=0;r<4;r++){var s=this.board[r];s.reverse();var a=this.processLine(s),i=a.newLine,o=a.scoreChange;this.score+=o,i.reverse(),e[r].join(",")!==i.join(",")&&(t=!0),this.board[r]=i}return!!t&&(this.generateNewTile(),this.checkGameStatus(),!0)}},{key:"moveUp",value:function(){if("playing"!==this.status)return!1;var e=this.deepCopy(this.board),t=!1;this.board=this.transposeBoard(this.board);for(var r=0;r<4;r++){var s=this.processLine(this.board[r]),a=s.newLine,i=s.scoreChange;this.score+=i,this.board[r]=a}this.board=this.transposeBoard(this.board);for(var o=0;o<4;o++)if(e[o].join(",")!==this.board[o].join(",")){t=!0;break}return!!t&&(this.generateNewTile(),this.checkGameStatus(),!0)}},{key:"moveDown",value:function(){if("playing"!==this.status)return!1;var e=this.deepCopy(this.board),t=!1;this.board=this.transposeBoard(this.board);for(var r=0;r<4;r++){var s=this.board[r];s.reverse();var a=this.processLine(s),i=a.newLine,o=a.scoreChange;this.score+=o,i.reverse(),this.board[r]=i}this.board=this.transposeBoard(this.board);for(var n=0;n<4;n++)if(e[n].join(",")!==this.board[n].join(",")){t=!0;break}return!!t&&(this.generateNewTile(),this.checkGameStatus(),!0)}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.board}},{key:"getStatus",value:function(){return this.status}},{key:"start",value:function(){this.generateNewTile(),this.generateNewTile(),this.status="playing",this.isStarted=!0}},{key:"restart",value:function(){this.board=this.initialBoardState.map(function(e){return e.slice()}),this.score=0,this.status="idle",this.start()}}],function(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}(t.prototype,e),t}()),t=document.querySelector(".game-field"),r=document.querySelector(".button"),s=document.querySelector(".game-score"),a=document.querySelector(".message-start"),i=document.querySelector(".message-win"),o=document.querySelector(".message-lose");function n(){var n,h;n=e.getState(),t.querySelectorAll(".field-cell").forEach(function(e,t){var r=Math.floor(t/4),s=t%4;if(n[r]&&void 0!==n[r][s]){var a=n[r][s];e.textContent=0===a?"":a,e.className="field-cell",0!==a&&e.classList.add("field-cell--".concat(a))}}),s.textContent=e.getScore(),h=e.getStatus(),e.isStarted?(r.textContent="Restart",r.classList.remove("start"),r.classList.add("restart")):(r.textContent="Start",r.classList.add("start"),r.classList.remove("restart")),a.classList.add("hidden"),i.classList.add("hidden"),o.classList.add("hidden"),"win"===h?i.classList.remove("hidden"):"lose"===h?o.classList.remove("hidden"):"idle"===h&&a.classList.remove("hidden")}r&&t&&s&&(r.addEventListener("click",function(){"playing"===e.getStatus()||e.isStarted?e.restart():e.start(),n()}),document.addEventListener("keydown",function(t){if("playing"===e.getStatus()){var r=!1;switch(t.key){case"ArrowRight":r=e.moveRight();break;case"ArrowLeft":r=e.moveLeft();break;case"ArrowUp":r=e.moveUp();break;case"ArrowDown":r=e.moveDown();break;default:return}r&&(t.preventDefault(),n())}}),n())}();
//# sourceMappingURL=index.a249ea9a.js.map
